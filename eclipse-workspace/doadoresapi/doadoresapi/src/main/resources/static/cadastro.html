<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Cadastro de Doador</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f0f2f5; margin: 0; padding: 0; }
        header { background: #28a745; color: white; padding: 20px; text-align: center; font-size: 24px; font-weight: bold; }
        .container { max-width: 500px; margin: 30px auto; background: #fff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        input, select, button { width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 5px; border: 1px solid #ccc; font-size: 14px; }
        button { background: #28a745; color: white; cursor: pointer; transition: background 0.3s; }
        button:hover { background: #218838; }
        #message { margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<header>
    Cadastro de Doador
</header>

<div class="container">
    <form id="form">
        <input type="text" name="nome" placeholder="Nome" required>
        <input type="text" name="cpf" placeholder="CPF" required>
        <input type="text" name="rua" placeholder="Rua">
        <input type="text" name="numero" placeholder="Número">
        <input type="text" name="bairro" placeholder="Bairro">
        <input type="text" name="cidade" placeholder="Cidade">
        <input type="text" name="estado" placeholder="Estado">
        <input type="text" name="cep" placeholder="CEP">
        <input type="text" name="telefone" placeholder="Telefone">
        <input type="email" name="email" placeholder="Email">
        <select name="tipoSanguineo">
            <option value="">Tipo Sanguíneo</option>
            <option value="A+">A+</option>
            <option value="A-">A-</option>
            <option value="B+">B+</option>
            <option value="B-">B-</option>
            <option value="AB+">AB+</option>
            <option value="AB-">AB-</option>
            <option value="O+">O+</option>
            <option value="O-">O-</option>
        </select>
        <button type="submit">Salvar</button>
    </form>
    <span id="message"></span>
</div>

<script>
    const urlParams = new URLSearchParams(window.location.search);
    const doadorId = urlParams.get('id');
    const form = document.getElementById('form');
    const message = document.getElementById('message');

    if (doadorId) {
        carregarDoador(doadorId);
    }

    async function carregarDoador(id) {
        try {
            const res = await fetch(`https://doadores-spring.onrender.com/doadores/${id}`);
            if (res.ok) {
                const doador = await res.json();
                form.nome.value = doador.nome;
                form.cpf.value = doador.cpf;
                form.rua.value = doador.rua;
                form.numero.value = doador.numero;
                form.bairro.value = doador.bairro;
                form.cidade.value = doador.cidade;
                form.estado.value = doador.estado;
                form.cep.value = doador.cep;
                form.telefone.value = doador.telefone;
                form.email.value = doador.email;
                form.tipoSanguineo.value = doador.tipoSanguineo;

                form.cpf.disabled = true; // Não permite editar o CPF
            } else {
                message.textContent = 'Erro ao carregar dados.';
                message.style.color = 'red';
            }
        } catch (err) {
            message.textContent = 'Erro ao carregar dados.';
            message.style.color = 'red';
        }
    }

    form.addEventListener('submit', async function(e) {
        e.preventDefault();
        const doador = {
            nome: form.nome.value,
            cpf: form.cpf.value,
            rua: form.rua.value,
            numero: form.numero.value,
            bairro: form.bairro.value,
            cidade: form.cidade.value,
            estado: form.estado.value,
            cep: form.cep.value,
            telefone: form.telefone.value,
            email: form.email.value,
            tipoSanguineo: form.tipoSanguineo.value
        };

        try {
            let res;
            if (doadorId) {
                res = await fetch(`https://doadores-spring.onrender.com/doadores/${doadorId}`, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(doador)
                });
            } else {
                res = await fetch(`https://doadores-spring.onrender.com/doadores`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(doador)
                });
            }
            if (res.ok) {
                message.textContent = 'Doador salvo com sucesso!';
                message.style.color = 'green';
            } else {
                message.textContent = 'Erro ao salvar doador.';
                message.style.color = 'red';
            }
        } catch (err) {
            message.textContent = 'Erro ao salvar doador.';
            message.style.color = 'red';
        }
    });
</script>

</body>
</html>
